#!/bin/bash

# Stop execution if any command fails
set -e

# 1. Update and upgrade Ubuntu
echo "Updating and upgrading Ubuntu..."
sudo apt-get update && sudo apt-get upgrade -y

# 2. Install Docker
echo "Installing Docker..."
sudo apt-get install -y docker.io

# Ensure the Docker service is started
sudo systemctl start docker
# Enable Docker to start at boot
sudo systemctl enable docker

# Add the current user to the Docker group (optional)
# Note: You'll need to log out and log back in for this to take effect
sudo usermod -aG docker $USER

# 3. Pull a Docker image
# Replace "hello-world" with your desired image
echo "Pulling Docker image..."
docker pull daucu/daucu_frontend

# Get the server's public IP address
public_ip=$(curl -s http://ifconfig.me/ip)

# Run the Docker image with the public IP address
docker run -d -p 3000:3000 --restart unless-stopped -e NEXT_PUBLIC_API_URL=http://$public_ip:9000 daucu/daucu_frontend

# Run backend container on port 9000 daucu/daucu_backend
docker run -d -p 9000:9000 --restart unless-stopped daucu/daucu_backend

echo "Script execution completed."
